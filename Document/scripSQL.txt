-- Tạo cơ sở dữ liệu
CREATE DATABASE SalesManagementSystem;

-- Sử dụng cơ sở dữ liệu
USE SalesManagementSystem;

-- Tạo bảng Employee
CREATE TABLE Employee (
    EmployeeID INT PRIMARY KEY AUTO_INCREMENT,
    Name VARCHAR(50) NOT NULL,
    Phone VARCHAR(12),
    Username VARCHAR(30) NOT NULL UNIQUE,
    Password VARCHAR(255) NOT NULL,
    Role BOOLEAN DEFAULT 0, -- 1: Quản trị viên, 0: Nhân viên
    Image BLOB
);

-- Tạo bảng Customer
CREATE TABLE Customer (
    CustomerID CHAR(10) PRIMARY KEY,
    CompanyName VARCHAR(50) NOT NULL,
    Phone VARCHAR(12) CHECK (LENGTH(Phone) = 12), -- Đảm bảo số điện thoại có 12 ký tự
    Address VARCHAR(60),
    Email VARCHAR(30) UNIQUE
);

-- Tạo bảng Category
CREATE TABLE Category (
    CategoryID INT PRIMARY KEY AUTO_INCREMENT,
    CategoryName VARCHAR(25) NOT NULL,
    Image BLOB
);

-- Tạo bảng Supplier
CREATE TABLE Supplier (
    SupplierID INT PRIMARY KEY AUTO_INCREMENT,
    SupplierName VARCHAR(50) NOT NULL,
    Phone VARCHAR(12),
    Address VARCHAR(60),
    Email VARCHAR(30)
);

-- Tạo bảng Product
CREATE TABLE Product (
    ProductID INT PRIMARY KEY AUTO_INCREMENT,
    ProductName VARCHAR(50) NOT NULL,
    CategoryID INT NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    SupplierID INT NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    Price DECIMAL(19, 4) NOT NULL CHECK (Price > 0), -- Đảm bảo giá luôn lớn hơn 0
    Quantity INT NOT NULL CHECK (Quantity >= 0), -- Đảm bảo số lượng không âm
    Image BLOB,
    FOREIGN KEY (CategoryID) REFERENCES Category(CategoryID)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (SupplierID) REFERENCES Supplier(SupplierID)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Tạo bảng Orders
CREATE TABLE Orders (
    OrderID INT PRIMARY KEY AUTO_INCREMENT,
    CustomerID CHAR(10) NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    EmployeeID INT NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    OrderDate DATE NOT NULL,
    TotalAmount DECIMAL(19, 4) NOT NULL CHECK (TotalAmount >= 0), -- Tổng tiền không âm
    OrderStatus ENUM('Processing', 'Completed', 'Cancelled') NOT NULL COMMENT 'Trạng thái đơn hàng', -- Thêm chú thích
    FOREIGN KEY (CustomerID) REFERENCES Customer(CustomerID)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (EmployeeID) REFERENCES Employee(EmployeeID)
        ON DELETE SET NULL ON UPDATE CASCADE
);

-- Tạo bảng OrderDetail
CREATE TABLE OrderDetail (
    OrderID INT NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    ProductID INT NOT NULL, -- Thêm NOT NULL cho khóa ngoại
    Quantity SMALLINT NOT NULL CHECK (Quantity > 0), -- Số lượng phải lớn hơn 0
    UnitPrice DECIMAL(19, 4) NOT NULL CHECK (UnitPrice > 0), -- Giá đơn vị phải lớn hơn 0
    PRIMARY KEY (OrderID, ProductID),
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (ProductID) REFERENCES Product(ProductID)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Xem tất cả các bảng trong cơ sở dữ liệu
SHOW TABLES;

-- Xem cấu trúc bảng Employee
DESCRIBE Employee;
